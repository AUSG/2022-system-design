- [개략적인 규모 측정](#개략적인-규모-측정)
  - [2의 제곱수](#2의-제곱수)
  - [모든 프로그래머가 알아야 하는 응답지연 값(latency)](#모든-프로그래머가-알아야-하는-응답지연-값latency)
  - [가용성에 관계된 수치들](#가용성에-관계된-수치들)
  - [QPS와 저장소 요구량 추정해보기](#qps와-저장소-요구량-추정해보기)
  - [TIP Note](#tip-note)
- [시스템 설계 면접 공략법](#시스템-설계-면접-공략법)
  - [효과적 면접을 위한 4단계 접근법](#효과적-면접을-위한-4단계-접근법)
    - [1단계: 문제 이해 및 설계 범위 확정](#1단계-문제-이해-및-설계-범위-확정)
    - [2단계: 개략적인 설계안 제시 및 동의 구하기](#2단계-개략적인-설계안-제시-및-동의-구하기)
    - [3단계: 상세 설계](#3단계-상세-설계)
    - [4단계: 마무리(후속 질문 등)](#4단계-마무리후속-질문-등)
  - [note. 시스템 설계 면접에서 해야 할 것과 하지 말아야 할 것들](#note-시스템-설계-면접에서-해야-할-것과-하지-말아야-할-것들)

## 개략적인 규모 측정

시스텀 설계 면접을 볼 때, 때는 시스템 용량이나 성능 요구사항을 개략적으로 추정해 보라는 요구를 받게 된다. `개략적 규모 추정`을 효과적으로 해 내려면 규모 확정성을 표현하는데 필요한 기본기에 능숙해야 한다. 특히 `2의 제곱수`나 `응답지연(latency)` 값, 그리고 `가용성에 관련된 수치`들을 기본적으로 잘 이해하고 있어야 한다.

### 2의 제곱수

- 분산 시스템에서 다루는 데이터 양은 엄청나게 커질 수 있으나 그 계산법은 기본을 크게 벗어나지 않는다.
- 데이터의 크기를 계산하기 위해서는 데이터 볼륨의 단위를 2의 제곱수로 표현하면 어떻게 되는지 우선 알아야한다. 1바이트=8비트, ASCII 문자 하나=1바이트 등등
- 다음은 흔히 쓰이는 데이터 볼륨 단위를 표로 나타낸 것이다. 외울 필요는 없지만 익숙해질 필요는 있을 것 같다.

![data-volume-table.png](https://user-images.githubusercontent.com/72328687/190849291-f33da650-20f0-41c8-97b3-9e9cd9ba6017.png)

### 모든 프로그래머가 알아야 하는 응답지연 값(latency)

- 다음 표는 구글의 제프 딘이 2010년에 공개한 통상적인 컴퓨터에서 구현된 연산들의 응답지연 값이다.
- 이들 가운데 몇몇은 더 빠른 컴퓨터가 등장하면서 더 이상 유효하지 않게 되었지만, 이 수치들은 컴퓨터 연산들의 처리 속도가 어느 정도인지 짐작할 수 있게 해준다.
- 아래 수치들을 살펴보면 다음과 같은 사실을 발견할 수 있다.
  - **메모리는 빠르지만 디스크는 아직도 느리다.**
  - **디스크 탐색(seek)은 가능한 한 피하라.**
  - **단순한 압축 알고리즘은 빠르다.**
  - **데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.**
  - **데이터 센터는 보통 여러 지역(region)에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.**

![data-volume-table.png](https://user-images.githubusercontent.com/72328687/190849289-d5f0a03a-20c6-45c5-847b-3a923df46ed5.png)

### 가용성에 관계된 수치들

- 고가용성을 표현하는 값은 퍼센트(percent)로 표현하는데 100%는 시스템이 단 한 번도 중단된 적이 없었음을 의미한다. 대부분의 서비스는 99%~100%의 값을 갖는다
  - `고가용성(high availability)`: 시스템이 오랜 시간 동안 지속적으로 중단없이 운영될 수 있는 능력을 지칭하는 용어
- `SLA`(Service Level Agreement)는 서비스 사업자(service provider)가 보편적으로 사용하는 용어로, 서비스 사업자와 고객 사이에 맺어진 합의를 의미하며 여기에는 `서비스 가용시간`(uptime)이 공식적으로 기술되어 있다.
- 아마존, 구글, 마이크로소프트 같은 사업자는 99% 이상의 SLA를 제공한다.
- 가용시간은 관습적으로 숫자 9를 사용해 표시하며 9가 많을수록 좋다고 보면 된다 이에 대한 수치는 다음 표를 확인하자

![data-volume-table.png](https://user-images.githubusercontent.com/72328687/190849293-4fb3ec00-7535-4b4f-b080-4cc641abe9e9.png)

### QPS와 저장소 요구량 추정해보기

- 다음 제시된 수치들로 QPS와 저장소 요구량을 추정해보자 (트위터의 기능을 예시로 든다)
- `가정`
  - **MAU(월간 능동 사용자: Monthly Active User)**는 3억(300million)
  - 50%의 사용자가 트위터를 매일 사용한다. (retention rate = 50%)
  - 평균적으로 각 사용자는 매일 2건의 트윗을 올린다
  - 미디어를 포함하는 트윗은 10% 정도다
  - 데이터는 5년간 보관한다
- `추정`
  - **QPS(Query Per Second) 추정치**
    - **DAU(일간 능동 사용자: Daily Active User)** = 3억 x 50% = 1.5억(150million)
    - QPS= 1.5억 x (2번의 트윗) / (24시간) / (3600초) = 약 3500
    - 따라서 최대 QPS(Peek QPS) = 2 X `QPS` = 약 7000
  - **미디어 저장을 위한 저장소 요구량**
    - 평균 트윗 크기
      - tweet_id: 64byte
      - text: 140byte
      - 미디어: 1MB
    - 미디어 저장소 요구랑: 1.5억 x 2 x 10% x 1 MB = 30TB / 일
    - 5년간 미디어를 보관하기 위한 저장소 요구량: 30TB x 365 x 5 = 약 55PB

### TIP Note

- 개략적인 규모 추정과 관계된 면접에서 가장 중요한 것은 문제를 풀어 나가는 절차이다.
- 결국 면접자가 보고 싶어 하는 것은 당신의 문제 해결 능력일 것이기에 올바른 절차를 밟느냐가 결과를 내는 것보다 중요하다.
- `TIPs`
  - **근사치를 활용한 계산(rounding and approximation): 면접장에서 복잡한 계산을 하는 것은 어려운 일이고, 계산 결과의 정확함을 평가하는 자리가 아니다. 그러므로 적절한 근사치를 활용해서 시간을 절약하자**
  - **가정(assumption)들은 기록해둬라. 나중에 이를 살펴볼 수 있도록 해야한다**
  - **단위(unit)을 붙여라. 5라고만 적으면 5KB인지 5MB인지 알 수 없으므로 스스로 헷갈릴 수 있다. 단위를 붙이는 습관을 들여 모호함을 방지하자**
  - 많이 출제되는 개략적 규모 추정 문제는 QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정하는 것이다. 면접에 임하기 전에 이런 값들을 계산하는 연습을 미리 하도록 하자. 완벽함을 달성하는 방법은 연습뿐이다.

## 시스템 설계 면접 공략법

- 항상 무언가를 공략하기 위해서는 근본적인 원리를 찾는 것이 중요하다.
- 시스템 설계 면접의 근본적인 요소들을 알아보고 정리해보자.
- **회사에서 시스템 설계 면접을 보는 이유가 무엇일까?**
  - 이에 대한 대답은 각기 다를 수 있지만, 시스템 설계 면접은 두 명의 동료가 모호한 문제를 풀기 위해 협력하여 그 해결책을 찾아내는 과정에 대한 시뮬레이션이다. 즉 이 문제에는 정해진 결말, 정답이 없다.
  - 그리고 이 면접은 당신의 설계 기술을 시연하는 자리이고, 설계 과정에서 내린 결정들에 대한 방어 능력을 보이는 자리이며, 면접관의 피드백을 건설적인 방식으로 처리할 자질이 있음을 보이는 자리인 것이다.
- **입장 바꿔서 면접관은 어떤 생각을 가지고 면접 자리에 들어올까?**
  - 일차적 목표는 지원자의 능력을 평가하는 것이다. 즉 면접이 매끄럽게 진행되지 않아서 충분한 시그널을 수집하지 못한 바람에 평가 결과를 확정 지을 수 없는 상황을 피하고 싶을 것이다.
  - 그리고 지원자가 내 바로 옆자리 동료가 될 수 있으니 같이 일하기에 좋은 사람인가?를 추가적으로 살펴보고 싶어할 것이다. 많은 사람이 지원자의 설계 능력의 기술적 측면을 평가하는 것이 주된 것이라 생각할 수 있지만, 사실 그 이상으로 지원자가 협력에 적합한 사람인지, 압박이 심한 상황도 잘 헤쳐나갈 자질이 있는지, 모호한 문제를 건설적으로 해결할 능력이 있는지 등을 살펴볼 수 있다.
  - 또한 훌륭한 면접관은 부정적인 신호를 놓치지 않는다. 완고함, 편협함, 설계의 순수성에 집착한 나머지 trade-off를 도외시하고 over-engineering을 할 것인지 등등

### 효과적 면접을 위한 4단계 접근법

그리고 긴장감이 생긴 상태에서는 그 가능성이 좀 더 높아진다. 시스템 설계 면접은 전부 제각각이고 훌륭한 설계 면접은 정해진 결말도 없고 정답도 없다. 하지만 그 절차나 범위에는 공통적인 부분이 있다. 효과적인 면접을 위해서 4단계 접근법을 정리해보고 이에 대비해보자.
p.s 사람은 늘 실수할 가능성이 있기 마련이다. 그리고 프로 선수는 대부분의 긴장되는 상황에서도 탁월하게 일을 해낸다. 그들은 이런 준비를 항상 미리 해두기 때문에 프로가 된 게 아닐까?

#### 1단계: 문제 이해 및 설계 범위 확정

시스템 설계 면접을 볼 때는 생각 없이 바로 답을 내서는 좋은 점수를 받기 어렵다.

- 요구사항을 완전히 이해하지 않고 답을 내놓는 행위는 아주 엄청난 부정적 신호(red flag)이다. 면접은 퀴즈쇼가 아니며, 정답 따위는 없다는 걸 상기하자
- 바로 답부터 들이밀지 말고 깊이 생각하고 질문하여 요구사항과 가정들을 분명히 하라. 이 단계의 중요성은 강조하고 또 강조해도 모자람이 없다.
- **엔지니어가 가져야 할 가장 중요한 기술 중 하나는 올바른 질문을 하는 것, 적절한 가정을 하는 것, 그리고 시스템 구축에 필요한 정보를 모으는 것이다**
- 문제 이해를 위해 다음과 같은 질문들을 해볼 수 있을 것 같다.
  - 구체적으로 어떤 기능을 만들어야 하나?
  - 제품 사용자 수는 얼마나 되나?
  - 회사의 규모는 얼마나 빨리 커지리라 예상하나? 석 달, 여섯 달, 일년 뒤의 규모는 얼마가 되리라 예상하는가?
  - 회사가 주로 사용하는 기술 스택은 무엇인가? 설계를 단순화하기 위해 활용할 수 있는 기존 서비스로는 어떤 것들이 있는가?

#### 2단계: 개략적인 설계안 제시 및 동의 구하기

이번 단계에서는 개략적인 설계안을 제시하고 면접관의 동의를 얻는 것에 집중해야한다. 이 과정은 면접관과 협력하여 진행하면 좋다. 원활한 소통으로 같이 일하기 좋은 사람임을 보여주면 좋다.

- **설계안에 대한 최초 청사진을 제시하고 의견을 구하라. 면접관을 마치 팀원인 것처럼 대하라. 훌륭한 면접관들은 지원자들과 대화하고 설계 과정에 개입하기를 즐긴다.**
- **화이트보드나 종이에 핵심 컴포넌트를 포함하는 다이어그램을 그려라. 클라이언트(모바일/웹), API, 웹 서버, 데이터 저장소, 캐시, CDN, 메시지 큐 같은 것들이 포함될 수 있을 것이다.**
- **이 최초 설계안이 시스템 규모에 관게된 제약사항들을 만족하는지를 개략적으로 계산해 보라. 계산 과정은 소리 내어 설명하라. 아울러, 이런 개략적 추정이 필요한지는 면접관에게 미리 물어보도록 하자.**

#### 3단계: 상세 설계

이 단계로 왔다면 당신은 면접관과 다음 목표는 달성한 상태일 것이다.

- **시스템에서 전반적으로 달성해야 할 목표와 기능 범위 확인**
- **전체 설계의 개략적 청사진 마련**
- **해당 청사진에 대한 면접관의 의견 청취**
- **상세 설계에서 집중해야 할 영역들 확인**

이 상황에서 이제 면접관과 해야 할 일은 설계 대상 컴포넌트 사이의 우선순위를 정하는 것이다. 똑같은 면접이란 있을 수 없으니 정해진 것은 없지만, 보통 면접자가 특정 시스템 컴포넌트의 세부사항을 깊이 있게 설명하는 것을 보길 원한다. 케이스가 너무 많아서 정답은 없으나 여기서 주의점은 다음과 같다.

- 시간 관리에도 특별히 주의를 기울이자. 사소한 세부사항을 설명하느라 정작 당신의 능력을 보일 기회를 놓쳐버릴 수도 있다. 면접관에게 긍정적 신호(signal)를 전달하는 데에 집중하고 불필요한 세부사항에 시간을 쓰지 말자.
- EdgeRank 알고리즘 등 특정 알고리즘에 대해 깊게 이야기 하는 것은 바람직하지 않을 수 있다. 시간을 너무 많이 쓰게 되는데다 당신이 규모 확장 가능한 시스템을 설계할 능력이 있다는 것을 입증하는 데도 도움이 되지 않는다.

#### 4단계: 마무리(후속 질문 등)

이 마지막 단계에서 면접관은 설계 결과물에 관련된 몇 가지 후속 질문을 던질 수도 있고 당신이 스스로 추가 논의를 진행하도록 할 수도 있다. 다음 몇 가지 지침을 활용하자.

- **면접관이 시스템 병목구간, 혹은 좀 더 개선한 지점을 찾아내라 주문할 수 있다. 개선할 점은 언제나 있기 마련이고 현재 설계가 완벽하다거나 개선할 부분이 없다는 답은 하지 않도록 하자. 이런 질문은 당신의 비판적 사고 능력을 보이고, 마지막으로 좋은 인상을 남길 기회이다.**
- **당신이 만든 설계를 한번 다시 요약해주는 것도 도움이 될 수 있다. 여러 해결책을 제시한 경우에는 특히 중요하며 긴 면접 세션이 끝난 뒤에 면접관의 기억을 환기시켜주는 효과도 있다.**
- **오류가 발생하면 무슨 일이 생기는지(서버 오류, 네트워크 장애 등) 따져보면 흥미로울 것이다.**
- **운영 이슈도 논의할 가치가 충분하다. 메트릭은 어떻게 수집하고 모니터링할 것인가? 로그는? 시스템은 어떻게 배포해(roll-out) 나갈 것인가?**
- **미래에 닥칠 규모 확장 요구에 어떻게 대처할 것인지도 흥미로운 주제다. e.g. 현재 설계로 백만 사용자는 능히 감당할 수 있다고 해보자. 천만 사용자를 감당하려면 어떻게 해야 하는가?**
- **시간이 좀 남았다면, 필요하지만 다루지 못했던 세부적 개선사항들을 제안할 수 있다.**

### note. 시스템 설계 면접에서 해야 할 것과 하지 말아야 할 것들

면접 세션에서 해야 할 것과 하지 말아야 할 것을 정리해보자

- `해야 할 것`
  - **질문을 통해 확인하라(clarification). 스스로 내린 가정이 옳다 믿고 진행하지 말라.**
  - **문제의 요구사항을 이해하라.**
  - **정답이나 최선의 답안 같은 것은 없단느 점을 명심하라. 스타트업을 위한 설계안과 수백만 사용자를 지원해야 하는 중견 기업을 위한 설계안이 같을리 없다. 요구사항을 정확하게 이해했는지 다시 확인하라.**
  - **면접관이 여러분의 사고 흐름을 이해할 수 있도록 하라. 면접관과 소통하라.**
  - **가능하다면 여러 해법을 함께 제시하라.**
  - **개략적 설계에 면접관이 동의하면, 각 컴포넌트의 세부사항을 설명하기 시작하라. 가장 중요한 컴포넌트부터 진행하라.**
  - **면접관의 아이디어를 이끌어 내라. 좋은 면접관은 여러분과 같은 팀원처럼 협력한다.**
  - **포기하지 말라.**
- `하지 말아야 할 것`
  - **전형적인 면접 문제들에도 대비하지 않은 상태로 면접장에 가지 말라.**
  - **요구사항이나 가정들을 분명히 하지 않은 상태에서 설계를 제시하지 말라.**
  - **처음부터 특정 컴포넌트의 세부사항을 너무 깊이 설명하지 말라. 개략적 설계를 마친 뒤에 세부사항으로 나아가라.**
  - **진행 중에 막혔다면, 힌트를 청하기를 주저하지 말라.**
  - **소통을 주저하지 말라. 침묵 속에 설계를 진행하지 말라.**
  - **설계안을 내놓는 순간 면접이 끝난다고 생각하지 말라. 면접관이 끝났다고 말하기 전까지는 끝난 것이 아니다. 의견을 일찍, 그리고 자주 구하라.**
